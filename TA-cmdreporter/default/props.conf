#################################
#  Base sourcetype (will be changed during parsing)
#################################  
[cmdreporter]
AUTO_KV_JSON = false
EVENT_BREAKER = ([\n\r]+){
EVENT_BREAKER_ENABLE = true
KV_MODE = none
INDEXED_EXTRACTIONS = JSON
LINE_BREAKER = ([\n\r]+){
MAX_TIMESTAMP_LOOKAHEAD = 10
NO_BINARY_CHECK = 1
SHOULD_LINEMERGE = 0
TIME_FORMAT = %s
TIME_PREFIX = \"time_seconds_epoch\"\:
TZ = UTC
# EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
# EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
# Drop events that are related to Splunk
#TRANSFORMS-set = set_null

# Change the sourcetype based on the type of event
TRANSFORMS-set_cmdrep_sourcetype = set_cmdrep_sourcetype_account,set_cmdrep_sourcetype_audit,set_cmdrep_sourcetype_auth,set_cmdrep_sourcetype_disk,set_cmdrep_sourcetype_exec,set_cmdrep_sourcetype_file,set_cmdrep_sourcetype_hardware,set_cmdrep_sourcetype_license,set_cmdrep_sourcetype_listen,set_cmdrep_sourcetype_misc,set_cmdrep_sourcetype_network,set_cmdrep_sourcetype_ptrace,set_cmdrep_sourcetype_session,set_cmdrep_sourcetype_task,set_cmdrep_sourcetype_time,set_cmdrep_sourcetype_service


#################################
#  Account
#################################  
[cmdreporter:account]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = case(match('header.event_name',"^AUE_create_.*"),"created",match('header.event_name',"^AUE_delete_.*"),"deleted",match('header.event_name',"^AUE_modify_.*"),"modified",match('header.event_name',"^AUE_add_to_group$"),"modified",true(),"unknown")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
EVAL-src_user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
REPORT-user = cmdrep-extract-account_user
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


#################################
#  Audit
#################################  
[cmdreporter:audit]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


#################################
#  Auth
#################################  
[cmdreporter:auth]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
EVAL-src_user = case('subject.process_name'="/usr/bin/sudo",'subject.audit_user_name',true(),'subject.effective_user_name')
EVAL-user = case('subject.process_name'="/usr/bin/sudo",'subject.effective_user_name','subject.audit_user_name'="-1", 'subject.effective_user_name', true(),'subject.audit_user_name')
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
REPORT-auth_mechanism = cmdrep-extract-auth_mech
REPORT-process_exec = cmdrep-extract-process_exec
# Text matching against: (mv 'texts{}' field with 1-3 entries)
# com.apple.ServiceManagement.daemons.modify
# client /usr/libexec/mdmclient
# creator /usr/libexec/mdmclient
EVAL-auth_target = ltrim(mvindex('texts{}', (mvfind('texts{}', "^client\s"))), "client ")
EVAL-auth_requestor = ltrim(mvindex('texts{}', (mvfind('texts{}', "^creator\s"))), "creator ")
EVAL-auth_category = mvindex('texts{}', (mvfind('texts{}', "^\w+\.\w+.+?")))
EVAL-touch_id_authentication = mvindex('texts{}', (mvfind('texts{}', "^Touch")))
REPORT-process_exec = cmdrep-extract-process_exec
EVAL-process_name = coalesce('process_exec', 'subject.process_name')
# EVAL-PIV_authentication

# Field Aliases
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
FIELDALIAS-signature = "identity.signer_id" AS signature
FIELDALIAS-signature_id = "identity.cd_hash" AS signature_id
FIELDALIAS-app = process_exec AS app
FIELDALIAS-dest = 'host_info.host_name' as dest
FIELDALIAS-dest_category = "auth_category" AS dest_category

# Static Evals
EVAL-vendor_product = "cmdReporter"



#################################
#  Disk / Volume
#################################  
[cmdreporter:disk]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-mount = 'path{}'
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
REPORT-process_exec = cmdrep-extract-process_exec
EVAL-process_name = coalesce('process_exec', 'subject.process_name')


#################################
#  Exec
#################################  
[cmdreporter:exec]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success","allowed","blocked")
EVAL-app = coalesce('subject.process_name', 'exec_args.args.1', 'path{}')
LOOKUP-cmdrep-man-page-lookup-exec-name = cmdrep-man-page-lookup NAME AS "exec_args.args.1" OUTPUTNEW DESCRIPTION AS process_man_page
LOOKUP-cmdrep-man-page-lookup-exec-path = cmdrep-man-page-lookup PATH AS "exec_args.args.1" OUTPUTNEW DESCRIPTION AS process_man_page
LOOKUP-cmdrep-man-page-lookup-subj-name = cmdrep-man-page-lookup NAME AS "subject.process_name" OUTPUTNEW DESCRIPTION AS process_man_page
LOOKUP-cmdrep-man-page-lookup-subj-path = cmdrep-man-page-lookup PATH AS "subject.process_name" OUTPUTNEW DESCRIPTION AS process_man_page
# cpu_load_percent
FIELDALIAS-dest = "host_info.host_name" AS dest
EVAL-exec_chain_combined_uuids = mvappend(exec_chain_child.parent_uuid,exec_chain_parent.uuid)
# mem_used
EVAL-os = "macOS"
# parent_process
# parent_process_exec
# parent_process_id
# EVAL-parent_process_guid = if(isnotnull('exec_chain_child.parent_uuid'), 'exec_chain_child.parent_uuid', null())
# parent_process_path
REPORT-piv_hash = cmdrep-extract-card_piv_hash
EVAL-process = coalesce('subject.process_name', 'exec_args.args.1', 'path{}')
REPORT-process_app_name = cmdrep-extract-process_app_name
EVAL-process_current_directory = if(isnotnull('exec_env.env.PWD'),'exec_env.env.PWD',"/")
REPORT-process_exec = cmdrep-extract-process_exec
EVAL-process_name = coalesce('process_exec', 'subject.process_name')
FIELDALIAS-process_name = "process_exec" as process_name
# process_hash
EVAL-process_id = if(isnotnull('subject.process_id'), 'subject.process_id', null())
# EVAL_process_name = coalesce('process_app_name', 'process_exec', 'subject.process_name')
EVAL-process_path = if(isnotnull('subject.process_name'), 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
# REPORT-service_name = cmdrep-extract-exec-service_name
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-status = if('return.description'="success","started","failed")
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-user_id = "subject.audit_id" as user_id
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"
LOOKUP-parent_process_path_lookup2 = parent_child_exec_lookup 'exec_chain_parent.uuid' AS 'exec_chain_child.parent_uuid' OUTPUTNEW 'path' AS 'parent_process_path', 'process_name' AS 'parent_process'


#################################
#  File
#################################  
[cmdreporter:file]
AUTO_KV_JSON = false
KV_MODE = none
# file_acl - not currently supported
# file_hash - not currently supported
# file_size - not currently supported
# process_guid
# process_id - not currently supported
# user - not currently supported
EVAL-action = case(file_event_info.item_created="true","created",file_event_info.item_removed="true","deleted",file_event_info.item_cloned="true","read",file_event_info.item_renamed="true","modified",file_event_info.item_updated="true","modified",file_event_info.item_change_owner="true","acl_modified",file_event_info.item_extended_attribute_modified="true","acl_modified",file_event_info.item_finder_info_modified="true","modified",file_event_info.item_metadata_modified="true","modified",true(),"unknown")
FIELDALIAS-dest = "host_info.host_name" AS dest
FIELDALIAS-file_access_time = "header.time_seconds_epoch" AS file_access_time
EVAL-file_create_time = if('file_event_info.item_created'="true",'header.time_seconds_epoch',null())
EVAL-file_modify_time = if('file_event_info.item_updated'="true",'header.time_seconds_epoch',null())
REPORT-file_name = cmdrep-extract-file_name
FIELDALIAS-file_path = "file_event_info.path" AS file_path
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"

# Change fields



#################################
#  Hardware
#################################  
[cmdreporter:hardware]
AUTO_KV_JSON = false
KV_MODE = none
REPORT-piv_hash = cmdrep-extract-hardware_piv_hash
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"

EVAL-action = case('hardware_event_info.device_status'="disconnected","stopped",'hardware_event_info.device_status'="connected","modified",'hardware_event_info.device_status'="already_connected","read",true(),"unknown")
EVAL-change_type = "hardware"




#################################
#  Internal
#################################  
[cmdreporter:internal]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


#################################
#  Listen
#################################  
[cmdreporter:listen]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "allowed", "blocked")

FIELDALIAS-creation_time = "header.time_seconds_epoch" AS creation_time
EVAL-dest = case('socket_inet.ip_address'="::","0.0.0.0",'socket_inet.ip_address'!="*","0.0.0.0",true(),'socket_inet.ip_address')
EVAL-dest_ip = case('socket_inet.ip_address'="::","0.0.0.0",'socket_inet.ip_address'!="*","0.0.0.0",true(),'socket_inet.ip_address')
FIELDALIAS-dest_port = "socket_inet.port" AS dest_port
EVAL-direction = "inbound"
REPORT-icmp_code = cmdrep-extract-icmp_code
EVAL-process = coalesce('subject.process_name', 'exec_args.args.1', 'path{}')
REPORT-process_name = cmdrep-extract-process_app_name
FIELDALIAS-process_current_directory = "exec_env.env.PWD" AS process_current_directory
REPORT-process_exec = cmdrep-extract-process_exec
EVAL-app = if(isnotnull('process_app_name'), 'process_app_name', 'subject.process_name')
EVAL-process_id = if(isnotnull('subject.process_id'), 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
EVAL-protocol = "ip"
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-state = "listening"
EVAL-transport = case(socket_inet.family="1","icmp",socket_inet.family="2","igmp",socket_inet.family="26","af_inet6",socket_inet.family="0","ip",true(),socket_inet.family)
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"
LOOKUP-parent_process_path_lookup3 = parent_child_exec_lookup 'exec_chain_parent.uuid' AS 'exec_chain_child.parent_uuid' OUTPUTNEW 'path' AS 'parent_process_path', 'process_name' AS 'parent_process'
# EVAL-action = if('return.description'="success", "allowed", "blocked")
# EVAL-dest = case('socket_inet.ip_address'="::","0.0.0.0",'socket_inet.ip_address'!="*","0.0.0.0",true(),'socket_inet.ip_address')
# EVAL-dest_ip = case('socket_inet.ip_address'="::","0.0.0.0",'socket_inet.ip_address'!="*","0.0.0.0",true(),'socket_inet.ip_address')
# FIELDALIAS-dest_port = "socket_inet.port" AS dest_port
# EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
# EVAL-direction = "inbound"
# EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
# FIELDALIAS-serial = "host_info.serial_number" AS serial
# FIELDALIAS-src_host = "host_info.host_name" AS src_host
# EVAL-state = "listening"
# EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
# FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
# EVAL-transport = case('socket_inet.family'="1","icmp",'socket_inet.family'="2","igmp",'socket_inet.family'="6","tcp",'socket_inet.family'="17","udp",true(),'socket_inet.family')
# EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
# FIELDALIAS-vendor_action = "return.description" AS vendor_action
# FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
# FIELDALIAS-creation_time = "header.time_seconds_epoch"
# EVAL-vendor_product = "cmdReporter"



#################################
#  Misc
#################################  
[cmdreporter:misc]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


#################################
#  Network
#################################  
[cmdreporter:network]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = case('return.description'="success","allowed",'return.description'="failure : No route to host","blocked",'return.description'="failure : Operation now in progress","allowed",'return.description'="failure : Socket is already connected","allowed",'return.description'="failure : Resource busy","blocked",'return.description'="failure : Operation not permitted","blocked",'return.description'="failure: Unknown error: 250","blocked",'return.description'="failure : Network is down","blocked",true(),"unknown")
# EVAL-action = if(return.description="success","allowed","blocked")
# bytes_in
# bytes_out
# channel
REPORT-icmp_code = cmdrep-extract-icmp_code
# dest_mac
# dest_translated_ip
# dest_translated_port
EVAL-protocol = ip
EVAL-direction = "outbound"
FIELDALIAS-dest = "socket_inet.ip_address" AS dest
FIELDALIAS-dest_ip = "socket_inet.ip_address" AS dest_ip
FIELDALIAS-dest_port = "socket_inet.port" AS dest_port
REPORT-process_exec = cmdrep-extract-process_exec
EVAL-process_id = if(isnotnull(subject.process_id) AND subject.process_id!="0", subject.process_id, null())
EVAL-process_path = if(isnotnull(subject.process_name) AND subject.process_id!="0", subject.process_name, null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
# FIELDALIAS-src_port = "socket_inet.port" as src_port
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-state = case('return.error'="0","established",'return.error'="1","not permitted",'return.error'="16","resource busy",'return.error'="126","can't assign address",'return.error'="127","down",'return.error'="133","already connected",'return.error'="148","no route to host",'return.error'="150","in progress",true(),"unknown")
EVAL-transport = case(socket_inet.family="1","icmp",socket_inet.family="2","igmp",socket_inet.family="26","af_inet6",socket_inet.family="0","ip",true(),socket_inet.family)
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"
EVAL-app = coalesce('identity.signer_id','subject.process_name','process_exec')
EVAL-process = coalesce('subject.process_name', 'exec_args.args.1', 'path{}')
REPORT-process_app_name = cmdrep-extract-process_app_name
EVAL-process_current_directory = if(isnotnull('exec_env.env.PWD'),'exec_env.env.PWD',"/")
REPORT-process_exec = cmdrep-extract-process_exec
EVAL-process_id = if(isnotnull('subject.process_id'), 'subject.process_id', null())
FIELDALIAS-process_name = "process_exec" as process_name
EVAL-process_path = if(isnotnull('subject.process_name'), 'subject.process_name', null())
LOOKUP-parent_process_path_lookup4 = parent_child_exec_lookup 'exec_chain_parent.uuid' AS 'exec_chain_child.parent_uuid' OUTPUTNEW 'path' AS 'parent_process_path', 'process_name' AS 'parent_process'
#################################
#  PTrace
#################################  
[cmdreporter:ptrace]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "allowed", "blocked")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"
LOOKUP-parent_process_path_lookup5 = parent_child_exec_lookup 'exec_chain_parent.uuid' AS 'exec_chain_child.parent_uuid' OUTPUTNEW 'path' AS 'parent_process_path', 'process_name' AS 'parent_process'

#################################
#  Service
#################################  
[cmdreporter:service]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success","allowed","blocked")
EVAL-app = coalesce('subject.process_name', 'exec_args.args.1', 'path{}')
LOOKUP-cmdrep-man-page-lookup-exec-name = cmdrep-man-page-lookup NAME AS "exec_args.args.1" OUTPUTNEW DESCRIPTION AS process_man_page
LOOKUP-cmdrep-man-page-lookup-exec-path = cmdrep-man-page-lookup PATH AS "exec_args.args.1" OUTPUTNEW DESCRIPTION AS process_man_page
LOOKUP-cmdrep-man-page-lookup-subj-name = cmdrep-man-page-lookup NAME AS "subject.process_name" OUTPUTNEW DESCRIPTION AS process_man_page
LOOKUP-cmdrep-man-page-lookup-subj-path = cmdrep-man-page-lookup PATH AS "subject.process_name" OUTPUTNEW DESCRIPTION AS process_man_page
LOOKUP-parent_process_path_lookup6 = parent_child_exec_lookup 'exec_chain_parent.uuid' AS 'exec_chain_child.parent_uuid' OUTPUTNEW 'path' AS 'parent_process_path', 'process_name' AS 'parent_process'
# cpu_load_percent
FIELDALIAS-dest = "host_info.host_name" AS dest
EVAL-exec_chain_combined_uuids = mvappend(exec_chain_child.parent_uuid,exec_chain_parent.uuid)
# mem_used
EVAL-os = "macOS"
# parent_process
# parent_process_exec
# parent_process_id
EVAL-parent_process_guid = if(isnotnull('exec_chain_child.parent_uuid'), 'exec_chain_child.parent_uuid', null())
# parent_process_path
REPORT-piv_hash = cmdrep-extract-card_piv_hash
EVAL-process = coalesce('subject.process_name', 'exec_args.args.1', 'path{}')
REPORT-process_exec = cmdrep-extract-process_exec
# process_hash
EVAL-process_id = if(isnotnull('subject.process_id'), 'subject.process_id', null())
FIELDALIAS-process_name = "process_exec" as process_name
# EVAL_process_name = coalesce('process_app_name', 'process_exec', 'subject.process_name')
EVAL-process_path = if(isnotnull('subject.process_name'), 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
# REPORT-service_name = cmdrep-extract-exec-service_name
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-status=case('return.error'="0","success",'return.error'="1","not permitted",'return.error'="16","resource busy",'return.error'="126","can't assign address",'return.error'="127","down",'return.error'="133","already connected",'return.error'="148","no route to host",'return.error'="150","in progress",true(),"unknown")
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-user_id = "subject.audit_id" as user_id
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-dest_ip = "socket_inet.ip_address" AS dest_ip
FIELDALIAS-dest_port = "socket_inet.port" AS dest_port
REPORT-process_app_name = cmdrep-extract-process_app_name
EVAL-process_current_directory = if(isnotnull('exec_env.env.PWD'),'exec_env.env.PWD',"/")
EVAL-service = if(isnotnull('identity.signer_id'), 'identity.signer_id', null())
EVAL-service_exec = if(isnotnull('subject.process_name'), 'subject.process_name', 'app')
EVAL-service_id = if(isnotnull('identity.signer_id'), 'identity.signer_id', null())
EVAL-service_path = if(isnotnull('subject.process_name'), 'subject.process_name', 'app')

#################################
#  Session
#################################  
[cmdreporter:session]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


#################################
#  Task
#################################  
[cmdreporter:task]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-process_id = if(isnotnull('process.process_id') AND 'process.process_id'!="0", 'process.process_id', null())
EVAL-process_path = if(isnotnull('process.process_name') AND 'process.process_id'!="0", 'process.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"
LOOKUP-parent_process_path_lookup1 = parent_child_exec_lookup 'exec_chain_parent.uuid' AS 'exec_chain_child.parent_uuid' OUTPUTNEW 'path' AS 'parent_process_path', 'process_name' AS 'parent_process'

#################################
#  Time
#################################  
[cmdreporter:time]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
EVAL-src = if(isnotnull('subject.terminal_id.ip_address') AND 'subject.terminal_id.ip_address'="0.0.0.0",'host_info.host_name','subject.terminal_id.ip_address')
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if(isnotnull('subject.audit_user_name') AND 'subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"

