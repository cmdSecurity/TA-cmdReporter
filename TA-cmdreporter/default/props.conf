# Base sourcetype (will be changed during parsing)
[cmdreporter]
AUTO_KV_JSON = false
EVENT_BREAKER = ([\n\r]+){
EVENT_BREAKER_ENABLE = true
KV_MODE = none
INDEXED_EXTRACTIONS = JSON
LINE_BREAKER = ([\n\r]+){
MAX_TIMESTAMP_LOOKAHEAD = 10
NO_BINARY_CHECK = 1
SHOULD_LINEMERGE = 0
TIME_FORMAT = %s
TIME_PREFIX = \"time_seconds_epoch\"\:
TZ = UTC

# Drop events that are related to Splunk
#TRANSFORMS-set = set_null

# Change the sourcetype based on the type of event
TRANSFORMS-set_cmdrep_sourcetype = set_cmdrep_sourcetype_account,set_cmdrep_sourcetype_audit,set_cmdrep_sourcetype_auth,set_cmdrep_sourcetype_disk,set_cmdrep_sourcetype_exec,set_cmdrep_sourcetype_file,set_cmdrep_sourcetype_hardware,set_cmdrep_sourcetype_license,set_cmdrep_sourcetype_listen,set_cmdrep_sourcetype_misc,set_cmdrep_sourcetype_network,set_cmdrep_sourcetype_ptrace,set_cmdrep_sourcetype_session,set_cmdrep_sourcetype_task,set_cmdrep_sourcetype_time


# Account
[cmdreporter:account]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = case(match('header.event_name',"^AUE_create_.*"),"created",match('header.event_name',"^AUE_delete_.*"),"deleted",match('header.event_name',"^AUE_modify_.*"),"modified",match('header.event_name',"^AUE_add_to_group$"),"modified",true(),"unknown")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
EVAL-src_user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
REPORT-user = cmdrep-extract-account_user
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Audit
[cmdreporter:audit]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Auth
[cmdreporter:auth]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
EVAL-src_user = case('subject.process_name'="/usr/bin/sudo",'subject.audit_user_name',true(),'subject.effective_user_name')
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = case('subject.process_name'="/usr/bin/sudo",'subject.effective_user_name','subject.audit_user_name'="-1", 'subject.effective_user_name', true(),'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Disk / Volume
[cmdreporter:disk]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-mount = 'path{}'
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Exec
[cmdreporter:exec]
AUTO_KV_JSON = false
KV_MODE = none
LOOKUP-cmdrep-man-page-lookup-subj-path = cmdrep-man-page-lookup PATH AS "subject.process_name" OUTPUTNEW DESCRIPTION AS process_man_page
LOOKUP-cmdrep-man-page-lookup-subj-name = cmdrep-man-page-lookup NAME AS "subject.process_name" OUTPUTNEW DESCRIPTION AS process_man_page
LOOKUP-cmdrep-man-page-lookup-exec-path = cmdrep-man-page-lookup PATH AS "exec_args.args.1" OUTPUTNEW DESCRIPTION AS process_man_page
LOOKUP-cmdrep-man-page-lookup-exec-name = cmdrep-man-page-lookup NAME AS "exec_args.args.1" OUTPUTNEW DESCRIPTION AS process_man_page
REPORT-piv_hash = cmdrep-extract-card_piv_hash
EVAL-action = if('return.description'="success","allowed","blocked")
EVAL-app = coalesce('subject.process_name', 'path{}')
REPORT-process_exec = cmdrep-extract-process_exec
#FIELDALIAS-process_hash = "identity.cd_hash" AS process_hash
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# File
[cmdreporter:file]
AUTO_KV_JSON = false
KV_MODE = none
FIELDALIAS-file_access_time = "header.time_seconds_epoch" AS file_access_time
EVAL-action = case('file_event_info.item_created'="true","created",'file_event_info.item_removed'="true","deleted",'file_event_info.item_cloned'="true","read",'file_event_info.item_renamed'="true","modified",'file_event_info.item_updated'="true","modified",'file_event_info.item_change_owner'="true","acl_modified",'file_event_info.item_extended_attribute_modified'="true","acl_modified",'file_event_info.item_finder_info_modified'="true","modified",'file_event_info.item_metadata_modified'="true","modified",true(),"unknown")
FIELDALIAS-dest = "host_info.host_name" AS dest
# file_acl - not currently supported
EVAL-file_create_time = if(action="created",'header.time_seconds_epoch',null())
# file_hash - not currently supported
EVAL-file_modify_time = if(action="modified",'header.time_seconds_epoch',null())
REPORT-file_name = cmdrep-extract-file_name
FIELDALIAS-file_path = "file_event_info.path" AS file_path
# file_size - not currently supported
# process_id - not currently supported
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
# user - not currently supported
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Hardware
[cmdreporter:hardware]
AUTO_KV_JSON = false
KV_MODE = none
REPORT-piv_hash = cmdrep-extract-hardware_piv_hash
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Internal
[cmdreporter:internal]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Listen
[cmdreporter:listen]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "allowed", "blocked")
EVAL-dest = case('socket_inet.ip_address'="::","0.0.0.0",'socket_inet.ip_address'!="*","0.0.0.0",true(),'socket_inet.ip_address')
EVAL-dest_ip = case('socket_inet.ip_address'="::","0.0.0.0",'socket_inet.ip_address'!="*","0.0.0.0",true(),'socket_inet.ip_address')
FIELDALIAS-dest_port = "socket_inet.port" AS dest_port
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
EVAL-state = "listening"
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-transport = case('socket_inet.family'="1","icmp",'socket_inet.family'="2","igmp",'socket_inet.family'="6","tcp",'socket_inet.family'="17","udp",true(),'socket_inet.family')
EVAL-user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Misc
[cmdreporter:misc]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Network
[cmdreporter:network]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success","allowed","blocked")
FIELDALIAS-dest_ip = "socket_inet.ip_address" AS dest_ip
FIELDALIAS-dest_port = "socket_inet.port" AS dest_port
REPORT-process_exec = cmdrep-extract-process_exec
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-transport = case('socket_inet.family'="1","icmp",'socket_inet.family'="2","igmp",'socket_inet.family'="6","tcp",'socket_inet.family'="17","udp",true(),'socket_inet.family')
EVAL-user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# PTrace
[cmdreporter:ptrace]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "allowed", "blocked")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Session
[cmdreporter:session]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Task
[cmdreporter:task]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-process_id = if(isnotnull('process.process_id') AND 'process.process_id'!="0", 'process.process_id', null())
EVAL-process_path = if(isnotnull('process.process_name') AND 'process.process_id'!="0", 'process.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"


# Time
[cmdreporter:time]
AUTO_KV_JSON = false
KV_MODE = none
EVAL-action = if('return.description'="success", "success", "failure")
EVAL-process_id = if(isnotnull('subject.process_id') AND 'subject.process_id'!="0", 'subject.process_id', null())
EVAL-process_path = if(isnotnull('subject.process_name') AND 'subject.process_id'!="0", 'subject.process_name', null())
FIELDALIAS-serial = "host_info.serial_number" AS serial
FIELDALIAS-src = "host_info.host_name" AS src
FIELDALIAS-src_host = "host_info.host_name" AS src_host
FIELDALIAS-src_uuid = "host_info.host_uuid" AS src_uuid
EVAL-user = if('subject.audit_user_name'="-1", 'subject.effective_user_name', 'subject.audit_user_name')
FIELDALIAS-vendor_action = "return.description" AS vendor_action
FIELDALIAS-vendor_eventtype = "header.event_name" AS vendor_eventtype
EVAL-vendor_product = "cmdReporter"

