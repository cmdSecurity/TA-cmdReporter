# Command-to-description lookup
[cmdrep-man-page-lookup]
batch_index_query = 0
case_sensitive_match = 0
filename = cmdrep-man-page-description.csv
match_type = WILDCARD(PATH), WILDCARD(NAME)

# Extract the username from the account text
[cmdrep-extract-account_user]
SOURCE_KEY = texts{}
REGEX = record\stype\s\w+\s'(?P<user>\w+)'\snode

# Extract the filename for a file event
[cmdrep-extract-file_name]
SOURCE_KEY = file_event_info.path
REGEX = (^\/.+\/(?P<file_name>.+)$)

# Extract the process name from the process_exec field
[cmdrep-extract-process_exec]
SOURCE_KEY = subject.process_name
# REGEX = ^.*\/(?P<process_exec>.*)$ 
REGEX = (^\/.+\/(?P<process_exec>.+)$)

[cmdrep-extact-process_app_name]
SOURCE_KEY = subject.process_name
REGEX = (\/.+\/(?<process_app_name>.+\.app)\/)

# piv hash from card insert events
[cmdrep-extract-hardware_piv_hash]
SOURCE_KEY = hardware_event_info.device_name
REGEX = (\w+\.\w+\.\w+\:(?P<piv_hash>\w+))

# piv hash from hardware key insert events
[cmdrep-extract-card_piv_hash]
SOURCE_KEY = exec_args.args_compiled
REGEX = (.+UserSelector,\-o,\w+,\-i,(?P<piv_hash>.+))

# CIM_Auth Extractions
[cmdrep-extract-auth_mech]
SOURCE_KEY = texts{}
REGEX = (^mechanism\s(?P<auth_mech>\w+):(?P<auth_mech_verb>.+))

[cmdrep-extract-icmp_code]
SOURCE_KEY = return.description
REGEX = (?:failure\s:\s)?(?P<icmp_code>.*)

# [cmdrep-extract-auth_category]
# SOURCE_KEY = texts{}
# REGEX = ((?<auth_category>^\w+\.\w+.+?)$)

# [cmdrep-extract-auth_requestor]
# SOURCE_KEY = texts{}
# REGEX = (^creator\s(?<auth_requestor>\/.+)$)

# [cmdrep-extract-auth_target]
# SOURCE_KEY = texts{}
# REGEX = (^client\s(?<auth_target>\/.+)$)

# Send any events related to Splunk to the nullQueue (to avoid cyclic logging)
[set_null]
DEST_KEY = queue
FORMAT = nullQueue
REGEX = (?:splunk|Splunk)

# Sourcetyping - Account (group/user)
[set_cmdrep_sourcetype_account]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:account
REGEX = ^AUE_(?:create|delete|modify|add_to)_(?:group|password|user)$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Audit
[set_cmdrep_sourcetype_audit]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:audit
REGEX = ^AUE_(?:AUDIT|SETAUDIT_ADDR)$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Authentication
[set_cmdrep_sourcetype_auth]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:auth
REGEX = ^AUE_(?:lw_login|login|ssauthint|ssauthmech|ssauthorize|auth_user)$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Disk / Volume
[set_cmdrep_sourcetype_disk]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:disk
REGEX = ^AUE_(?:MOUNT|UNMOUNT)$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Execution
[set_cmdrep_sourcetype_exec]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:exec
REGEX = ^AUE_(?:EXECVE|EXEC|INITPROCESS|FORK|MAC_SET_PROC|POSIX_SPAWN|VFORK)$
SOURCE_KEY = field:header.event_name

# Sourcetyping - File
[set_cmdrep_sourcetype_file]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:file
REGEX = ^FILE_EVENT$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Hardware
[set_cmdrep_sourcetype_hardware]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:hardware
REGEX = ^HARDWARE_EVENT$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Internal
[set_cmdrep_sourcetype_internal]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:internal
REGEX = ^(?:LICENSE_INFO_EVENT|SIGNAL_EVENT)$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Listen
[set_cmdrep_sourcetype_listen]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:listen
REGEX = ^AUE_(?:BIND|LISTEN)$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Misc
[set_cmdrep_sourcetype_misc]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:misc
REGEX = ^AUE_GETAUID$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Network
[set_cmdrep_sourcetype_network]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:network
REGEX = ^AUE_(?:CONNECT|SENDFILE|openssh|ACCEPT)$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Process Trace
[set_cmdrep_sourcetype_ptrace]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:ptrace
REGEX = ^AUE_PTRACE$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Session
[set_cmdrep_sourcetype_session]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:session
REGEX = ^AUE_(?:logout|SESSION_\w+)$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Service
[set_cmdrep_sourcetype_service]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:service
REGEX = ^(?:-1)$
SOURCE_KEY = field:subject.audit_user_name

# Sourcetyping - Task
[set_cmdrep_sourcetype_task]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:task
REGEX = ^AUE_(?:PIDFORTASK|TASKNAMEFORPID)$
SOURCE_KEY = field:header.event_name

# Sourcetyping - Time
[set_cmdrep_sourcetype_time]
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::cmdreporter:time
REGEX = ^AUE_SETTIMEOFDAY$
SOURCE_KEY = field:header.event_name

